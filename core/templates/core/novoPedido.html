{% extends 'core/base.html' %}
{% load bootstrap %}
{% load static %}
{% block main %}

        <style>
            .errorlist{
                color: red;
            }
        </style>   
        <h3 align="center">Novo Pedido</h3>
        <form action="" method="post" id="pedidoForm" muda_preco_url="{% url 'core:ajax_muda_preco' %}">
            {% csrf_token %}
            {{ form1|bootstrap }}
            {{ form2|bootstrap }} 

            <div id="rentabilidade" style="color:green" >
                    Rentabilidade boa
            </div>
            <br>
        
            <input type="submit" value="Adicionar novo Item" name="Adicionar" class="btn btn-primary" >
            <input type="submit" value="Salvar Pedido" name="Salvar" class="btn btn-success">
           
        </form>
        <form>
            <input type="submit" value="Cancelar" name="Cancelar" class="btn btn-danger">
        </form>



<script>

    const preco_produtos = {
        'Millenium​ ​Falcon':550000,
        'X-Wing':60000,
        'Super​ ​Star​ ​Destroyer':4570000,
        'TIE​ ​Fighter':75000,
        'Lightsaber':6000,
        'DLT-19​ ​Heavy​ ​Blaster​ ​Rifle':5800,
        'DL-44​ ​Heavy​ ​Blaster​ ​Pistol':1500
    }

    $(document).ready(function() {
        $('#id_produto').change(function () {
            // url da view responsvel por calcular o novo preço
            var url = $("#pedidoForm").attr("muda_preco_url"); 
            // novo produto selecionado pelo usuario
            var produto = $(this).val();  
           // console.log(preco_produtos[produto])
            $.ajax({                       
                url: url, //url da view
                data: {
                    'produto': produto  //informa a view qual o novo produto escolhido pelo usuario
                },            
                success: function (preco) {   // preco é o retorno da função implementada nas views, logo o novo preço que será mostrado ao usuário
                    $('input[name="preco_digitado_pelo_usuario"]').val(preco);
                    $('#rentabilidade').html('Rentabilidade boa')
                    $('#rentabilidade').css('color','green')
                }
            });
        });

        $('input[name="preco_digitado_pelo_usuario"]').keyup(function(){
            var preco = $(this).val();
            var produto = $('#id_produto').val()
            console.log(preco_produtos[produto])
            
            
           // verifica a rentabilidade se for ruim avisa ao usuário
            if(preco < (preco_produtos[produto] - (preco_produtos[produto]*0.1) )){
                console.log('ruim')
                $('#rentabilidade').html('Rentabilidade ruim')
                $('#rentabilidade').css('color','red')
            } else if (preco > preco_produtos[produto]){
                console.log('otimo')
                $('#rentabilidade').html('Rentabilidade ótima')
                $('#rentabilidade').css('color','green')
            } else {
                console.log('boa')
                $('#rentabilidade').html('Rentabilidade boa')
                $('#rentabilidade').css('color','green')
            }    
            //dica para mim mesmo, ao mudar o produto mudar a rentabilidade para boa
            //ao cliclar em submite rentabilidade mesmo estando ruim vai para boa mudar isso
            
        });

    });
</script>




{% endblock %}